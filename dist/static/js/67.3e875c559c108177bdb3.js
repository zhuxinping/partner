webpackJsonp([67],{HPOs:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("gyMJ"),a=s("TXDt"),i=s("JGtj"),o=s("X2Oc"),r={name:"addSmartOrder",components:{MHeader:a.a},mixins:[i.a],data:function(){return{infoInform:Object(o.n)("infoInform"),schoolName:"",money:"",paymoney:"",summary:"",summaryLength:0,bugProudctIndex:0,buyProductArry:[],bugTimeIndex:0,buyTimeArry:[],productId:"",agentAuthId:"",purchaseTimeId:"",info:"",submitFlag:!0}},beforeRouteEnter:function(t,e,s){"ZtsmartOrder"===e.name&&(t.meta.isBack=!0),e.name?t.meta.info=t.params.info:t.meta.info="null",s()},activated:function(){this.info="null"===this.$route.meta.info?"":JSON.parse(this.$route.meta.info),document.getElementById("money").addEventListener("input",Object(o.e)(this.keyupMoney,10),!1),document.getElementById("paymoney").addEventListener("input",Object(o.e)(this.keyupMoney1,10),!1),this.schoolName=this.info.schoolName,this.infoInform=Object(o.n)("infoInform"),this.submitFlag=!0,this.getBuyProductList(),this.getBuyTimeList(),this.$route.meta.isBack&&(this.money="",this.paymoney="",this.summary="",this.bugProudctIndex=0,this.bugTimeIndex=0,this.productId="",this.agentAuthId="",this.purchaseTimeId=""),this.$route.meta.isBack=!1},methods:{handleClose:function(){this.$router.push("/smartOrder")},selectSchoolName:function(){this.$router.push("/selectSchool/2")},bugProudct:function(t,e,s){this.bugProudctIndex=t,this.productId=e,this.agentAuthId=s,this.money&&(this.money=parseFloat(this.money.replace(/,/g,"")),this.getEarningsAmount(),this.money=Object(o.p)(Object(o.o)(this.money)))},bugTime:function(t,e){this.bugTimeIndex=t,this.purchaseTimeId=e},keyupMoney:function(){this.money=this.money.replace(/[^.0-9]/g,""),this.getEarningsAmount()},keyupMoney1:function(){this.paymoney=this.paymoney.replace(/[^.0-9]/g,"")},focusMoney:function(t){if(t){if(this.paymoney&&-1!==this.paymoney.toString().indexOf(",")){var e=this.paymoney.replace(/,/g,"");this.paymoney=parseFloat(e)}}else if(this.money){if(-1!==this.money.toString().indexOf(",")){var s=this.money.replace(/,/g,"");this.money=parseFloat(s)}this.getEarningsAmount()}},blurMoney:function(t){var e=/^[0-9]+([.]{1}[0-9]+){0,1}$/;t?e.test(this.paymoney)?this.paymoney=Object(o.p)(Object(o.o)(this.paymoney)):this.paymoney="":e.test(this.money)?(this.getEarningsAmount(),this.money=Object(o.p)(Object(o.o)(this.money))):(this.money="",this.paymoney="")},getEarningsAmount:function(){var t=this;if(this.money){var e={};e.orderAmount=parseFloat(toString(this.money).replace(/,/g,""))||this.money,e.agentAuthId=this.agentAuthId||this.buyProductArry[0].agentAuthId,n.a.getEarningsAmount(e,function(e){1e4===e.code?t.paymoney=e.body:Object(o.q)(e.message)})}},getBuyProductList:function(){var t=this,e={};e.agentId=this.infoInform.id,n.a.getAgentProductAuthList(e,function(e){1e4===e.code?t.buyProductArry=e.body:Object(o.q)(e.message)})},getBuyTimeList:function(){var t=this;n.a.getCampusDuration({},function(e){1e4===e.code?t.buyTimeArry=e.body:Object(o.q)(e.message)})},cancelFrom:function(){this.handleClose()},submitFrom:function(){var t=this;if(this.submitFlag&&this.validate())if(this.buyProductArry.length){if(parseFloat(this.money.replace(/,/g,""))<parseFloat(this.paymoney.replace(/,/g,"")))return void Object(o.q)("收益池收入不可大于订单金额！");var e={};e.agentId=this.infoInform.id,e.schoolId=this.info.schoolId,e.agentChildAccount=this.infoInform.agentChildAccount,e.productId=this.productId?this.productId:this.buyProductArry[0].productId,e.agentAuthId=this.agentAuthId?this.agentAuthId:this.buyProductArry[0].agentAuthId,e.campusDuration=this.purchaseTimeId?this.purchaseTimeId:this.buyTimeArry[0].campusDuration,e.orderAmount=parseFloat(this.money.replace(/,/g,"")),e.earningsAmount=parseFloat(this.paymoney.replace(/,/g,"")),e.remark=this.summary,this.submitFlag=!1,n.a.addCampusOrder(e,function(e){1e4===e.code?(Object(o.m)("orderFlag","1"),t.$router.push("/smartOrder")):(t.submitFlag=!0,Object(o.q)(e.message))}).catch(function(e){t.submitFlag=!0,Object(o.q)("提交异常，请检查网络或者联系管理员！")})}else Object(o.q)("代理商尚未获得智慧校园的产品授权，请联系公司总部申请授权。")}},watch:{summary:function(t,e){this.summaryLength=t.length},money:function(t,e){t.length>7&&-1===t.indexOf(",")&&-1===t.indexOf(".")?this.money=t.substr(0,7):t.length>7&&-1===t.indexOf(",")&&-1!==t.indexOf(".")&&(this.money=t.substr(0,10))},paymoney:function(t,e){t.length>7&&-1===t.indexOf(",")&&-1===t.indexOf(".")?this.paymoney=t.substr(0,7):t.length>7&&-1===t.indexOf(",")&&-1!==t.indexOf(".")&&(this.paymoney=t.substr(0,10))}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",{staticClass:"flex"},[n("m-header",{attrs:{headerTitle:"新增订单"},on:{backClick:t.handleClose}})],1),t._v(" "),n("div",{staticClass:"main"},[n("form",{ref:"parent",attrs:{action:"",name:"form"}},[n("ul",{staticClass:"from-table"},[n("li",{staticClass:"table-li"},[n("img",{staticClass:"required",attrs:{src:s("2lpC"),alt:""}}),t._v(" "),n("span",{staticClass:"key-content"},[t._v("学校名称")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.schoolName,expression:"schoolName"}],staticClass:"value-content",attrs:{name:"schoolName",type:"text",readonly:"",placeholder:"请选择学校"},domProps:{value:t.schoolName},on:{click:t.selectSchoolName,input:function(e){e.target.composing||(t.schoolName=e.target.value)}}}),t._v(" "),n("img",{staticClass:"back",attrs:{src:s("CiDD"),alt:""}})]),t._v(" "),n("li",{staticClass:"back-type"},[n("img",{staticClass:"required",attrs:{src:s("2lpC"),alt:""}}),t._v(" "),n("span",{staticClass:"key-content"},[t._v("购买产品")]),t._v(" "),n("div",{staticClass:"bug-content"},t._l(t.buyProductArry,function(e,s){return n("div",{key:s,staticClass:"value-bug",class:t.bugProudctIndex==s?"click-span":"",on:{click:function(n){return t.bugProudct(s,e.productId,e.agentAuthId)}}},[t._v(t._s(e.productName))])}),0)]),t._v(" "),n("li",{staticClass:"back-type"},[n("img",{staticClass:"required",attrs:{src:s("2lpC"),alt:""}}),t._v(" "),n("span",{staticClass:"key-content"},[t._v("购买时长")]),t._v(" "),n("div",{staticClass:"bug-content"},t._l(t.buyTimeArry,function(e,s){return n("span",{key:s,staticClass:"value-time",class:t.bugTimeIndex==s?"click-span":"",on:{click:function(n){return t.bugTime(s,e.campusDuration)}}},[t._v(t._s(e.campusDuration)+"个月")])}),0)]),t._v(" "),n("li",{staticClass:"table-li"},[n("img",{staticClass:"required",attrs:{src:s("2lpC"),alt:""}}),t._v(" "),n("span",{staticClass:"key-content"},[t._v("订单金额(元)")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.money,expression:"money"}],staticClass:"value-content",attrs:{name:"money",id:"money",type:"text",placeholder:"请输入本单订单金额"},domProps:{value:t.money},on:{focus:function(e){return t.focusMoney(0)},blur:function(e){return t.blurMoney(0)},input:function(e){e.target.composing||(t.money=e.target.value)}}})]),t._v(" "),n("li",{staticClass:"table-li"},[n("img",{staticClass:"required",attrs:{src:s("2lpC"),alt:""}}),t._v(" "),n("span",{staticClass:"key-content"},[t._v("收益池收入(元)")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.paymoney,expression:"paymoney"}],staticClass:"value-content",attrs:{name:"paymoney",id:"paymoney",type:"text",placeholder:"请输入本单代理商的收益金额"},domProps:{value:t.paymoney},on:{focus:function(e){return t.focusMoney(1)},blur:function(e){return t.blurMoney(1)},input:function(e){e.target.composing||(t.paymoney=e.target.value)}}})]),t._v(" "),n("li",{staticClass:"table-li table-textarea"},[t._m(0),t._v(" "),n("div",{staticClass:"value-textarea"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.summary,expression:"summary"}],staticStyle:{"margin-left":"-6px"},attrs:{maxlength:"200"},domProps:{value:t.summary},on:{input:function(e){e.target.composing||(t.summary=e.target.value)}}}),t._v(" "),n("span",{staticClass:"count"},[t._v(t._s(t.summaryLength)+"/200字")])])])])]),t._v(" "),n("footer",[n("ul",{staticClass:"table-button"},[n("li",{on:{click:t.cancelFrom}},[t._v("取消")]),t._v(" "),n("li",{staticClass:"from",on:{click:t.submitFrom}},[t._v("提交订单")])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"key-top"},[e("span",{staticClass:"key-content key-span"},[this._v("备注")])])}]},u=s("VU/8")(r,c,!1,null,null,null);e.default=u.exports}});