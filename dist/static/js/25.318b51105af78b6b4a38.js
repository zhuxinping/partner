webpackJsonp([25],{"/Mc7":function(t,e){},"9AMT":function(t,e,a){"use strict";var i=a("X2Oc"),s=a("+aT9"),n=a.n(s),r=void 0,c=1;e.a={data:function(){return{address:""}},beforeCreate:function(){n.a.plugin("AMap.Geocoder",function(){r=new n.a.Geocoder({})})},mounted:function(){this.locationAddress()},methods:{locationAddress:function(){this.address="";var t=this;dd.device.geolocation.get({targetAccuracy:100,coordinate:1,withReGeocode:!0,useCache:!1,onSuccess:function(a){4==~~a.errorCode&&(dd.device.notification.alert({message:"手机定位服务没有开启，请在设置中打开GPS定位服务开关",title:"温馨提示",buttonName:"我知道了"}),t.address="未开启定位权限！"),""!==a.latitude&&""!==a.longitude||Object(i.g)("成功方法钉钉定位错误",a,{}),a.address?(t.address=a.address,clearTimeout(e)):r.getAddress([a.longitude,a.latitude],function(s,n){"complete"===s&&n.regeocode?(t.address=n.regeocode.formattedAddress,t.address||(Object(i.g)("高德错误",a,{}),t.address="获取当前位置失败，请点击这一行,重新获取！"),clearTimeout(e)):Object(i.g)("高德错误",a,{})}),Object(i.m)("longitude",a.longitude),Object(i.m)("latitude",a.latitude)},onFail:function(a){Object(i.g)("失败方法钉钉定位错误",a,{}),4==~~a.errorCode||445==~~a.errorCode?(dd.device.notification.alert({message:"您已禁止授予钉钉 定位 权限，会造成该功能不可用，请到手机的 设置 里找到钉钉这个应用，并授予 定位 权限",title:"温馨提示",buttonName:"我知道了"}),t.address="未开启定位权限！"):c<=3&&(c++,clearTimeout(e),t.locationAddress())}});var e=setTimeout(function(){""===t.address&&(t.address="获取当前位置超时，请点击这一行,重新获取！")},1e4)}}}},DTFu:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=(a("2EZA"),a("W/os")),r=a.n(n),c=a("7+uW"),o=a("X2Oc"),l=a("gyMJ"),u=a("TXDt"),d=a("OMsH"),m=a("j1Tj"),h=a("9AMT"),p=a("JGtj"),f=a("PJh5"),g=a.n(f);c.default.component(r.a.name,r.a);var v={name:"add-visited",components:{MHeader:u.a,VUpload:d.a,VDictionary:m.a},data:function(){return{schoolName:"",visitedPerson:"",schoolTypeId:"",callDay:"",returnWay:"上门回访",infoInform:Object(o.n)("infoInform"),returnType:"",wayValue:[],typeValue:[],popupVisible:!1,summaryLength:0,submitFlag:!0,timeTamp:"",pickerValue:new Date,startDate:new Date("2010-01-01"),endDate:new Date("2030-12-31"),returnTypeIndex:"",returnTypeCode:null,summary:"",children_select:[],pickerFlag:!1,dictionaryArray:[],dictionaryIndex:null,picValueList:[],info:""}},mixins:[h.a,p.a],beforeRouteEnter:function(t,e,a){"Ztbackvisited"===e.name&&(t.meta.isBack=!0),e.name?t.meta.info=t.params.info:t.meta.info="null",a()},activated:function(){this.infoInform=Object(o.n)("infoInform"),this.info="null"===this.$route.meta.info?"":JSON.parse(this.$route.meta.info),this.schoolName=this.info.schoolName,this.visitedPerson=this.info.userName,this.submitFlag=!0;var t=this.info.schoolType;this.schoolTypeId="报备园"===t?1:"正式园"===t?2:"演示园"===t?3:"演示园报备"===t?4:"无效园"===t?5:"异常园"===t?6:"自主注册园"===t?7:"潜在园"===t?8:"报备申请"===t?9:0,this.locationAddress(),this.$route.meta.isBack&&(this.picValueList=[],this.returnTypeIndex="",this.returnTypeCode=null,this.summary="",this.children_select=[],this.returnWay="上门回访",this.$refs.upload.photoLength=0,this.callDay=g()().format("MM-DD")+"  "+g()().format("HH:mm"),this.timeTamp=g()().format("YYYY-MM-DD")+" "+g()().format("HH:mm:ss")),this.$route.meta.isBack=!1},mounted:function(){var t=this;this.getInformation(),this.callDay=g()().format("MM-DD")+"  "+g()().format("HH:mm"),this.timeTamp=g()().format("YYYY-MM-DD")+" "+g()().format("HH:mm:ss"),this.$nextTick(function(){t.endDate=new Date(g()().add(10,"years").format("YYYY/MM/DD"))}),sessionStorage.clear()},methods:{timeFilters:function(t){return t=t<10?"0"+t:""+t},handleClose:function(){sessionStorage.clear(),this.$router.push("/backvisited")},changeImg:function(t){this.picValueList=t},getInformation:function(){var t=this;Object(o.f)("RETURN_VISIT_WAY",1).then(function(e){t.wayValue=e}),Object(o.f)("RETURN_VISIT_TYPE",1).then(function(e){t.typeValue=e})},selectSchoolName:function(){this.photoIng()&&this.$router.push({path:"/selectSchool/0"})},selectPersonName:function(){if(this.photoIng()){if(!this.info)return Object(o.q)("请先选择学校！"),!1;this.$router.push({path:"/selectPop/0/"+s()(this.info)})}},photoIng:function(){var t=!1;return this.picValueList.length&&(this.picValueList.forEach(function(e,a){0===e.picUrl1.length&&(t=!0)}),t&&Object(o.q)("图片正在上传,请稍后再选择联系人！")),t?0:1},openTime:function(){this.$refs.picker.open()},handleConfirm:function(t){var e=g()(t).format("MM-DD"),a=g()(new Date).format("YYYY-MM-DD"),i=g()(t).format("YYYY-MM-DD");a===i?(this.callDay=e+" "+this.timeFilters((new Date).getHours())+":"+this.timeFilters((new Date).getMinutes()),this.timeTamp=i+" "+this.timeFilters((new Date).getHours())+":"+this.timeFilters((new Date).getMinutes())+":00"):(this.callDay=e+" 00:00",this.timeTamp=i+" 00:00:00")},commonOpen:function(){var t=0;this.wayValue.forEach(function(e,a){3===e.code&&(t=a)}),this.dictionaryArray=this.wayValue,this.dictionaryIndex=Object(o.m)("returnWayDefault")?parseInt(Object(o.m)("returnWayDefault")):t,this.pickerFlag=!0},changeStatus:function(){this.dictionaryIndex=null,this.pickerFlag=!1},sureCommon:function(t,e,a){this.returnWay=e[a].name,Object(o.m)("returnWayIndex",e[a].code),Object(o.m)("returnWayDefault",a.toString()),this.pickerFlag=!1},selectType:function(t,e,a){var i=this;this.returnTypeCode=t,this.returnTypeIndex=e,Object(o.f)(a,1).then(function(t){i.children_select=t.reverse()})},onCommonSlots:function(t,e){if(e[0]){var a=0;this.commonSlots[0].values.forEach(function(t,i){t.code===e[0].code&&(a=i)}),this.commonSlots[0].defaultIndex=a}},selectChild:function(t,e,a){a=!a,this.$set(this.children_select[t],"check",a)},removeSession:function(){sessionStorage.clear()},getvisitSubType:function(){var t=[];return this.children_select.forEach(function(e){e.check&&t.push(e.code)}),t.join(",")},submitFrom:function(){var t=this;if(this.submitFlag&&this.validate()){var e={};e.schoolId=this.info.schoolId,e.createId=2,e.visitTime=this.timeTamp,e.returnVisitContacts=this.info.userNameBack,e.schoolContactsId=Object(o.m)("schoolContactsId"),e.creatorId=this.infoInform.id,e.visitPersonId=this.infoInform.id,e.visitorName=this.infoInform.trueName,e.creatorName=this.infoInform.trueName,e.updaterName=this.infoInform.trueName,e.visitorUserCenterId=this.infoInform.userCenterId,e.creatorUserCenterId=this.infoInform.userCenterId,e.updaterUserCenterId=this.infoInform.userCenterId,e.visitContent=this.summary,e.visitWay=Object(o.m)("returnWayIndex")?Object(o.m)("returnWayIndex"):3,e.visitType=this.returnTypeIndex,e.schoolType=this.schoolTypeId,e.createMethod=2,e.visitSubType=this.getvisitSubType();var a=void 0;if(a="获取当前位置超时，请点击这一行,重新获取！"===this.address?"获取当前定位超时！":this.address,e.location=a,e.userCenterIdDing=this.infoInform.userCenterId,this.picValueList.length){var i=!1;if(this.picValueList.forEach(function(t,e){0===t.picUrl1.length&&(i=!0)}),i)return Object(o.q)("图片正在上传,请稍后再提交！"),!1}this.picValueList.length&&this.picValueList.forEach(function(t,e){t.picUrl&&(t.picUrl=t.picUrl1)}),e.returnVisitPicList=this.picValueList,e.longitude=Object(o.m)("longitude"),e.latitude=Object(o.m)("latitude"),this.submitFlag=!1,l.a.addReturnVisit(e,function(a){1e4===a.code?(sessionStorage.clear(),t.$router.push("/backvisited")):(t.submitFlag=!0,Object(o.q)(a.msg),Object(o.g)("接口错误",a,e))}).catch(function(e){t.submitFlag=!0,Object(o.q)("提交异常，请检查网络或者联系管理员！"),Object(o.g)("catch错误",e,{})})}},cancelFrom:function(){sessionStorage.clear(),this.$router.push("/backvisited")}},watch:{summary:function(t,e){this.summaryLength=t.length}}},y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"flex"},[i("m-header",{attrs:{headerTitle:"新增客户回访"},on:{backClick:t.handleClose}})],1),t._v(" "),i("div",{staticClass:"main"},[i("form",{ref:"parent",attrs:{action:"",name:"form"}},[i("ul",{staticClass:"from-table"},[i("li",{staticClass:"table-li"},[i("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),t._v(" "),i("span",{staticClass:"key-content"},[t._v("学校名称")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.schoolName,expression:"schoolName"}],staticClass:"value-content",attrs:{name:"schoolName",type:"text",readonly:"",placeholder:"请选择学校"},domProps:{value:t.schoolName},on:{click:t.selectSchoolName,input:function(e){e.target.composing||(t.schoolName=e.target.value)}}}),t._v(" "),i("img",{staticClass:"back",attrs:{src:a("CiDD"),alt:""}})]),t._v(" "),i("li",{staticClass:"table-li"},[i("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),t._v(" "),i("span",{staticClass:"key-content"},[t._v("回访日期")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.callDay,expression:"callDay"}],staticClass:"value-content",attrs:{type:"text",readonly:""},domProps:{value:t.callDay},on:{click:t.openTime,input:function(e){e.target.composing||(t.callDay=e.target.value)}}}),t._v(" "),i("img",{staticClass:"back",attrs:{src:a("CiDD"),alt:""}}),t._v(" "),i("mt-datetime-picker",{ref:"picker",staticClass:"time",attrs:{type:"date",endDate:t.endDate,startDate:t.startDate},on:{confirm:t.handleConfirm},model:{value:t.pickerValue,callback:function(e){t.pickerValue=e},expression:"pickerValue"}})],1),t._v(" "),i("li",{staticClass:"table-li"},[i("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),t._v(" "),i("span",{staticClass:"key-content"},[t._v("回访对象")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.visitedPerson,expression:"visitedPerson"}],staticClass:"value-content",attrs:{name:"returnPerson",type:"text",readonly:"",placeholder:"请选择联系人"},domProps:{value:t.visitedPerson},on:{click:t.selectPersonName,input:function(e){e.target.composing||(t.visitedPerson=e.target.value)}}}),t._v(" "),i("img",{staticClass:"back",attrs:{src:a("CiDD"),alt:""}})]),t._v(" "),i("li",{staticClass:"table-li"},[i("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),t._v(" "),i("span",{staticClass:"key-content"},[t._v("回访方式")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.returnWay,expression:"returnWay"}],staticClass:"value-content",attrs:{type:"text",readonly:""},domProps:{value:t.returnWay},on:{click:function(e){return t.commonOpen()},input:function(e){e.target.composing||(t.returnWay=e.target.value)}}}),t._v(" "),i("img",{staticClass:"back",attrs:{src:a("CiDD"),alt:""}})]),t._v(" "),i("li",{staticClass:"back-type"},[i("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),t._v(" "),i("span",{staticClass:"key-content"},[t._v("回访类型")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.returnTypeIndex,expression:"returnTypeIndex"}],attrs:{type:"hidden",name:"returnType"},domProps:{value:t.returnTypeIndex},on:{input:function(e){e.target.composing||(t.returnTypeIndex=e.target.value)}}}),t._v(" "),t._l(t.typeValue,function(e,a){return i("p",{key:a,staticClass:"value-type",class:t.returnTypeCode==a?"click-span":"",on:{click:function(i){return t.selectType(a,e.code,e.description)}}},[t._v(t._s(e.name))])})],2),t._v(" "),8==t.returnTypeIndex?i("ul",{staticClass:"children-select"},t._l(t.children_select,function(e,a){return i("li",{key:a,staticClass:"children-li"},[i("span",{staticClass:"checkcont"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.check,expression:"item.check"}],attrs:{type:"checkbox",id:"checked"+a},domProps:{checked:Array.isArray(e.check)?t._i(e.check,null)>-1:e.check},on:{change:function(a){var i=e.check,s=a.target,n=!!s.checked;if(Array.isArray(i)){var r=t._i(i,null);s.checked?r<0&&t.$set(e,"check",i.concat([null])):r>-1&&t.$set(e,"check",i.slice(0,r).concat(i.slice(r+1)))}else t.$set(e,"check",n)}}}),t._v(" "),i("label",{attrs:{for:"checked"+a}})]),t._v(" "),i("span",{staticClass:"span",on:{click:function(i){return t.selectChild(a,e.code,e.check)}}},[t._v(t._s(e.name))])])}),0):t._e(),t._v(" "),i("li",{staticClass:"table-li table-textarea"},[t._m(0),t._v(" "),i("div",{staticClass:"value-textarea"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.summary,expression:"summary"}],attrs:{name:"returnSummary",maxlength:"500"},domProps:{value:t.summary},on:{input:function(e){e.target.composing||(t.summary=e.target.value)}}}),t._v(" "),i("span",{staticClass:"count"},[t._v(t._s(t.summaryLength)+"/500字")])])]),t._v(" "),i("li",{staticClass:"table-li"},[i("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),t._v(" "),i("div",{staticClass:"value-content value-location"},[i("img",{staticClass:"open-map",attrs:{src:a("IEjN"),alt:"打开高德地图的API"}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.address,expression:"address"}],staticClass:"value-content location-content",attrs:{type:"text",readonly:"",placeholder:"正在获取当前位置..."},domProps:{value:t.address},on:{click:function(e){return t.locationAddress()},input:function(e){e.target.composing||(t.address=e.target.value)}}})])]),t._v(" "),i("li",{staticClass:"table-li table-camera"},[i("v-upload",{ref:"upload",attrs:{picValueList:t.picValueList},on:{change:t.changeImg}})],1)])]),t._v(" "),i("footer",[i("ul",{staticClass:"table-button"},[i("li",{on:{click:t.cancelFrom}},[t._v("取消")]),t._v(" "),i("li",{staticClass:"from",on:{click:t.submitFrom}},[t._v("提交")])])])]),t._v(" "),i("v-dictionary",{attrs:{type:"1",pickerFlag:t.pickerFlag,code:"code",keyValue:"name",titleText:"回访类型",keyArray:t.dictionaryArray,defaultIndex:t.dictionaryIndex},on:{sureData:t.sureCommon,changeStatus:t.changeStatus}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"key-top"},[e("img",{staticClass:"required",attrs:{src:a("2lpC"),alt:""}}),this._v(" "),e("span",{staticClass:"key-content key-span"},[this._v("回访内容")])])}]},C=a("VU/8")(v,y,!1,null,null,null);e.default=C.exports},OMsH:function(t,e,a){"use strict";var i=a("Gu7T"),s=a.n(i),n=a("X2Oc"),r=(a("v2ns"),a("7QTg")),c=a("cEna"),o=a("mtWM"),l=a.n(o),u={name:"v-upload",components:{swiper:r.swiper,swiperSlide:r.swiperSlide,axios:l.a},props:{picValueList:Array},data:function(){return{progress:[],photoLength:0,sheetVisible:!1,infoInform:Object(n.n)("infoInform")?Object(n.n)("infoInform"):"",imgsFlag:!1,showBigImageFlag:!1,swiperOption:{zoom:!0},previewImg:[],imgData:{accept:"image/gif, image/jpeg, image/png, image/jpg"}}},mounted:function(){this.photoLength=Object(n.m)("picValueList")?Object(n.m)("picValueList").length:0},methods:{showBigImage:function(t){var e=this;this.$set(this.swiperOption,"initialSlide",t),setTimeout(function(){e.showBigImageFlag=!0},10)},closeBigImage:function(){this.showBigImageFlag=!1},deleteImg:function(t,e){this.picValueList.splice(e,1),this.progress.splice(e,1),this.photoLength=this.picValueList.length,this.$emit("change",this.picValueList)},loadFile:function(t){var e=this,i=this,r=t.target.files||t.dataTransfer.files,o=a("rKa9");r.length&&(t.target.values="",(r=[].concat(s()(r))).length>5-this.photoLength?Object(n.q)("照片最多上传五张！"):r.forEach(function(t,a){if(e.imgData.accept.indexOf(t.type)<=0)Object(n.q)("请选择正确的图片格式！");else{var s=new FormData;s.append("uploadify",t),s.append("userCenterIdDing",e.infoInform.userCenterId);var r={};r.picUrl=o,r.isFlag=0,r.picType=0,r.picUrl1="",i.$set(i.picValueList,i.picValueList.length,r),i.photoLength=i.picValueList.length,l.a.post(c.a.GETIMGURL,s,{onUploadProgress:function(t){var e=(t.loaded/t.total*100|0)+"%";i.$set(i.progress,i.picValueList.length-a-1,e)}}).then(function(t){t.data.flag?(i.picValueList[i.picValueList.length-a-1].picUrl=t.data.data+"?imageView/1/w/160/h/160",i.picValueList[i.picValueList.length-a-1].picUrl1=t.data.data):Object(n.q)(t.data.msg)}).catch(function(t){Object(n.g)("catch错误",t,{})})}}),this.$emit("change",this.picValueList))}}},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"upload"},[i("span",{staticClass:"businessspan"},[t._v("添加照片("+t._s(t.photoLength)+"/5张)")]),t._v(" "),t.picValueList.length||t.progress.length?i("div",{staticClass:"photoCamera"},t._l(t.picValueList,function(e,s){return i("div",{key:s,staticClass:"progress"},[i("img",{attrs:{src:e.picUrl,alt:""}}),t._v(" "),e.picUrl?i("div",{staticClass:"delete"},[i("p",{staticClass:"showImage",on:{click:function(e){return t.showBigImage(s)}}}),t._v(" "),i("img",{staticClass:"delete1",attrs:{src:a("H1qD"),alt:""},on:{click:function(a){return t.deleteImg(e,s)}}})]):t._e()])}),0):t._e(),t._v(" "),i("div",{staticClass:"progress-outer"},t._l(t.progress,function(t,e){return i("div",{key:e,staticClass:"progress1"},[i("p",{directives:[{name:"show",rawName:"v-show",value:"100%"!=t,expression:"item == '100%'? false:true"}],staticClass:"progress-p",style:"width:"+t})])}),0),t._v(" "),5!=t.picValueList.length?i("div",{staticClass:"camera"},[i("input",{ref:"upload",attrs:{type:"file",id:"file",accept:"image/*",multiple:"",readonly:""},on:{change:t.loadFile}}),t._v(" "),i("img",{attrs:{src:a("/+d3"),alt:""}})]):t._e(),t._v(" "),t.showBigImageFlag?i("div",{staticClass:"closeBigImage",on:{click:t.closeBigImage}},[i("swiper",{staticStyle:{height:"100%"},attrs:{options:t.swiperOption}},t._l(t.picValueList,function(t,e){return i("swiper-slide",{key:e},[i("div",{staticClass:"swiper-zoom-container"},[i("img",{attrs:{src:t.picUrl1,alt:""}})])])}),1)],1):t._e()])},staticRenderFns:[]};var m=a("VU/8")(u,d,!1,function(t){a("/Mc7")},"data-v-27f97bef",null);e.a=m.exports}});