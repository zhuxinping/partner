webpackJsonp([73],{S0qK:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("2EZA");var s=a("W/os"),i=a.n(s),n=a("7+uW"),o=a("TXDt"),r=a("gyMJ"),c=a("X2Oc"),l=a("KgXo"),d=a("PJh5"),u=a.n(d);n.default.component(i.a.name,i.a);var m={name:"studentRanking",components:{MHeader:o.a,VLoading:l.a},data:function(){return{popupVisible:!1,callDay:"",month:"本",list:[],infoInform:Object(c.n)("infoInform"),rankImg:a("m3Z4"),startTime:"请选择",endTime:"请选择",startDate:new Date("2018-01-01"),timeFalg:!0,endDate:new Date,pickerValue:new Date,type:null,topStr:"",yesterdayStr:"",timeFlag:0}},mounted:function(){this.type=~~this.$route.meta.type,this.type?(Object(c.r)("08_02_students_monthly_list","0"),this.getSchoolTime()):(Object(c.r)("08_01_students_monthly_list","0"),this.getAgentTime())},beforeRouteEnter:function(t,e,a){t.meta.type=t.params.type,t.meta.schoolId=t.params.schoolId,a()},methods:{goBack:function(){this.type?(Object(c.r)("08_02_back","1"),this.$router.push({path:"/reportBaseInfrom/3/"+this.$route.meta.schoolId})):(Object(c.r)("08_01_back","1"),this.$router.go(-1))},openTime:function(){this.timeFlag&&this.$refs.picker.open()},handleConfirm:function(t){document.getElementsByClassName("load-list")[0].scrollTop=0;var e=u()(t).format("YYYY-MM"),a=u()().format("YYYY-MM");this.month=e===a?"本":e.replace(/-/g,"年"),e===a?(this.timeFalg=!0,this.getData()):(this.timeFalg=!1,this.getData(e)),this.type?Object(c.r)("08_01_history__monthly_list","1"):Object(c.r)("08_02_history__monthly_list","1")},getSchoolTime:function(){var t=this,e={};e.schoolId=this.$route.meta.schoolId,r.a.getStudentRankStarDateBySchool(e,function(e){if(1e4===e.code){var a=e.body.substr(0,10);t.startDate=new Date(a),t.timeFlag=e.body?1:0,t.getData()}else Object(c.q)(e.message)})},getAgentTime:function(){var t=this,e={};e.agentId=this.infoInform.id,r.a.getStudentRankStarDateByAgent(e,function(e){if(1e4===e.code){var a=e.body.substr(0,10);t.startDate=new Date(a),t.timeFlag=e.body?1:0,t.getData()}else Object(c.q)(e.message)})},getData:function(t){this.type?t?this.historyDate(t):this.nowDate():this.agentDate(t)},nowDate:function(){var t=this,e={};e.schoolId=this.$route.meta.schoolId,r.a.getstudentrankbyschool(e,function(e){1e4===e.code&&e.body.length&&(t.list=e.body,e.body.forEach(function(t){t.studentPic=t.studentPic?t.studentPic+"?imageView/1/w/160/h/160":Object(c.d)("student",t.sexNew)})),t.$refs.loading.change()})},historyDate:function(t){var e=this,a={};a.schoolId=this.$route.meta.schoolId,a.date=t,r.a.getstudenthisrankByschool(a,function(t){1e4===t.code&&t.body.length&&(e.list=t.body,t.body.forEach(function(t){t.studentPic=t.studentPic?t.studentPic+"?imageView/1/w/160/h/160":Object(c.d)("student",t.sexNew)})),e.$refs.loading.change()})},agentDate:function(t){var e=this,a={};a.agentId=this.infoInform.id,t&&(a.date=t),r.a.getstudentrankbyagent(a,function(t){if(1e4===t.code&&t.body.list){e.list=t.body.list;var a=(t.body.yesterdayStr?t.body.yesterdayStr:u()().subtract(1,"days").format("YYYY-MM-DD")).split("-");e.yesterdayStr=a[1]+"月"+a[2]+"日",e.topStr=t.body.top?"学生排行榜TOP"+t.body.top:"",t.body.list.length&&t.body.list.forEach(function(t){t.userPic=t.userPic?t.userPic+"?imageView/1/w/160/h/160":Object(c.d)("student",t.sexNew)})}e.$refs.loading.change()})},toRule:function(){this.$router.push({path:"/studentRule"})}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"flex"},[a("MHeader",{attrs:{headerTitle:t.type?"学生排行榜-按学校":t.topStr},on:{backClick:t.goBack}}),t._v(" "),a("div",{staticClass:"time-nav"},[a("span",{on:{click:t.openTime}},[t._v(t._s(t.month)+"月排行 "),a("i",{class:t.timeFlag?"icon-select":""})]),t._v(" "),t.type&&t.timeFalg?a("em",[t._v("实时数据")]):t._e(),t._v(" "),!t.type&&t.timeFalg?a("em",[t._v("昨天("+t._s(t.yesterdayStr)+")")]):t._e()])],1),t._v(" "),a("ul",{staticClass:"load-list"},[t._l(t.list,function(e,s){return a("li",{key:s,staticClass:"rank-li"},[a("div",{staticClass:"list-left"},[e.score&&e.rank<=3?a("i",{staticClass:"common",class:1==e.rank?"rank1":2==e.rank?"rank2":3==e.rank?"rank3":""}):a("i",{staticClass:"common"},[t._v(t._s(e.score?e.rank:""))]),t._v(" "),a("img",{staticClass:"avtar-img",attrs:{src:t.type?e.studentPic:e.userPic,alt:""}}),t._v(" "),a("div",{staticClass:"user-info"},[a("span",{staticClass:"active"},[t._v(t._s(t.type?e.studentName:e.name))]),t._v(" "),a("span",[t._v(t._s(e.className))]),t._v(" "),t.type?t._e():a("span",{staticClass:"agent-school"},[a("em",[t._v(t._s(e.schoolNumber))]),t._v(" "),a("em",{staticClass:"name-str"},[t._v(t._s(e.schoolName))])])])]),t._v(" "),a("div",{staticClass:"list-right"},[s?t._e():a("span",{staticClass:"top"},[t._v("关爱值"),a("i",{staticClass:"icon-answer",on:{click:function(e){return e.stopPropagation(),t.toRule(e)}}})]),t._v(" "),a("span",{staticClass:"bom"},[t._v(t._s(e.score))]),t._v(" "),a("span",{staticClass:"last"},[t._v(t._s(e.familyNum)+"位家长关注")])])])}),t._v(" "),a("v-loading",{ref:"loading",attrs:{loadingFlag:!0}})],2),t._v(" "),a("mt-datetime-picker",{ref:"picker",staticClass:"time no-date",attrs:{type:"date",endDate:t.endDate,startDate:t.startDate},on:{confirm:t.handleConfirm},model:{value:t.pickerValue,callback:function(e){t.pickerValue=e},expression:"pickerValue"}})],1)},staticRenderFns:[]},g=a("VU/8")(m,h,!1,null,null,null);e.default=g.exports}});