webpackJsonp([66],{RVoa:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("gyMJ"),a=n("TXDt"),o=n("JGtj"),i=n("X2Oc"),r={name:"updateSmartOrder",components:{MHeader:a.a},mixins:[o.a],data:function(){return{infoInform:Object(i.n)("infoInform"),money:"",paymoney:"",summary:"",summaryLength:0,buyProductArry:[],buyTimeArry:[],purchaseTimeId:"",productId:"",agentAuthId:"",bugProudctIndex:0,bugTimeIndex:0,info:{},baseInform:"",submitFlag:!0}},beforeRouteEnter:function(t,e,n){t.meta.info=t.params.info,n()},mounted:function(){this.info=JSON.parse(this.$route.meta.info),this.getBuyProductList(),this.getBuyTimeList(),this.getDetail(this.info.orderNo),document.getElementById("money").addEventListener("input",Object(i.e)(this.keyupMoney,10),!1),document.getElementById("paymoney").addEventListener("input",Object(i.e)(this.keyupMoney1,10),!1)},methods:{handleClose:function(){this.$router.push("/smartOrder")},bugProudct:function(t,e,n){this.bugProudctIndex=t,this.productId=e,this.agentAuthId=n,this.money&&(this.money=parseFloat(this.money.replace(/,/g,"")),this.getEarningsAmount(),this.money=Object(i.p)(Object(i.o)(this.money)))},bugTime:function(t,e){this.bugTimeIndex=t,this.purchaseTimeId=e},keyupMoney:function(){this.money=this.money.replace(/[^.0-9]/g,""),this.getEarningsAmount()},keyupMoney1:function(){this.paymoney=this.paymoney.replace(/[^.0-9]/g,"")},focusMoney:function(t){if(t){if(this.paymoney&&-1!==this.paymoney.toString().indexOf(",")){var e=this.paymoney.replace(/,/g,"");this.paymoney=parseFloat(e)}}else if(this.money){if(-1!==this.money.toString().indexOf(",")){var n=this.money.replace(/,/g,"");this.money=parseFloat(n)}this.getEarningsAmount()}},blurMoney:function(t){var e=/^[0-9]+([.]{1}[0-9]+){0,1}$/;t?e.test(this.paymoney)?this.paymoney=Object(i.p)(Object(i.o)(this.paymoney)):this.paymoney="":e.test(this.money)?(this.getEarningsAmount(),this.money=Object(i.p)(Object(i.o)(this.money))):(this.money="",this.paymoney="")},getEarningsAmount:function(){var t=this;if(this.money){var e={};e.orderAmount=parseFloat(toString(this.money).replace(/,/g,""))||this.money,e.agentAuthId=this.agentAuthId||this.buyProductArry[0].agentAuthId,s.a.getEarningsAmount(e,function(e){1e4===e.code?t.paymoney=e.body:Object(i.q)(e.message)})}},getDetail:function(t){var e=this,n={};n.orderNo=t,s.a.getOrdreDetail(n,function(t){1e4===t.code?(e.baseInform=t.body,t.body.existMonth&&t.body.existproId?Object(i.q)("原订单中的购买产品和时长已失效，已帮您重新选择，请您确认!"):t.body.existMonth?Object(i.q)("原订单中的购买时长已失效，已帮您重新选择，请您确认!"):t.body.existproId&&Object(i.q)("原订单中的购买产品已失效，已帮您重新选择，请您确认!"),e.money=Object(i.p)(Object(i.o)(t.body.orderAmount)),e.paymoney=t.body.earningsAmountStr,e.summary=t.body.remark):Object(i.q)(t.message)})},getBuyProductList:function(){var t=this,e={};e.agentId=this.infoInform.id,s.a.getAgentProductAuthList(e,function(e){1e4===e.code?(t.buyProductArry=e.body,e.body.forEach(function(e,n){e.productId===~~t.info.productId&&(t.bugProudctIndex=n,t.agentAuthId=e.agentAuthId)})):Object(i.q)(e.message)})},getBuyTimeList:function(){var t=this;s.a.getCampusDuration({},function(e){1e4===e.code?(t.buyTimeArry=e.body,e.body.forEach(function(e,n){e.campusDuration===~~t.info.purchaseTimeId&&(t.bugTimeIndex=n)})):Object(i.q)(e.message)})},cancelFrom:function(){this.handleClose()},submitFrom:function(){var t=this;if(this.submitFlag&&this.validate())if(this.buyProductArry.length){if(parseFloat(this.money.replace(/,/g,""))<parseFloat(this.paymoney.replace(/,/g,"")))return void Object(i.q)("收益池收入不可大于订单金额！");var e={};e.agentId=this.infoInform.id,e.schoolId=this.info.schoolId,e.agentChildAccount=this.infoInform.agentChildAccount,e.productId=this.productId?this.productId:this.baseInform.existproId?this.buyProductArry[0].productId:this.info.productId,e.agentAuthId=this.agentAuthId,e.campusDuration=this.purchaseTimeId?this.purchaseTimeId:this.baseInform.existMonth?this.buyTimeArry[0].campusDuration:this.info.purchaseTimeId.toString(),e.orderAmount=parseFloat(this.money.replace(/,/g,"")),e.earningsAmount=parseFloat(this.paymoney.replace(/,/g,"")),e.remark=this.summary,e.orderNo=this.baseInform.orderNo,this.submitFlag=!1,s.a.updateCampusOrder(e,function(e){1e4===e.code?(Object(i.m)("orderFlag","1"),t.$router.push("/smartOrder")):(t.submitFlag=!0,Object(i.q)(e.message))}).catch(function(e){t.submitFlag=!0,Object(i.q)("提交异常，请检查网络或者联系管理员！")})}else Object(i.q)("代理商尚未获得智慧校园的产品授权，请联系公司总部申请授权。")}},watch:{summary:function(t,e){t&&(this.summaryLength=t.length)},money:function(t,e){t.length>7&&-1===t.indexOf(",")&&-1===t.indexOf(".")?this.money=t.substr(0,7):t.length>7&&-1===t.indexOf(",")&&-1!==t.indexOf(".")&&(this.money=t.substr(0,10))}}},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"flex"},[s("m-header",{attrs:{headerTitle:"修改订单"},on:{backClick:t.handleClose}})],1),t._v(" "),s("div",{staticClass:"main"},[s("form",{ref:"parent",attrs:{action:"",name:"form"}},[s("ul",{staticClass:"from-table"},[s("li",{staticClass:"table-li"},[s("img",{staticClass:"required",attrs:{src:n("2lpC"),alt:""}}),t._v(" "),s("span",{staticClass:"key-content"},[t._v("学校名称")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.baseInform.schoolName,expression:"baseInform.schoolName"}],staticClass:"value-content",attrs:{name:"schoolName",type:"text",readonly:"",placeholder:"请选择学校"},domProps:{value:t.baseInform.schoolName},on:{input:function(e){e.target.composing||t.$set(t.baseInform,"schoolName",e.target.value)}}})]),t._v(" "),s("li",{staticClass:"back-type"},[s("img",{staticClass:"required",attrs:{src:n("2lpC"),alt:""}}),t._v(" "),s("span",{staticClass:"key-content"},[t._v("购买产品")]),t._v(" "),s("div",{staticClass:"bug-content"},t._l(t.buyProductArry,function(e,n){return s("div",{key:n,staticClass:"value-bug",class:t.bugProudctIndex==n?"click-span":"",on:{click:function(s){return t.bugProudct(n,e.productId,e.agentAuthId)}}},[t._v(t._s(e.productName))])}),0)]),t._v(" "),s("li",{staticClass:"back-type"},[s("img",{staticClass:"required",attrs:{src:n("2lpC"),alt:""}}),t._v(" "),s("span",{staticClass:"key-content"},[t._v("购买时长")]),t._v(" "),s("div",{staticClass:"bug-content"},t._l(t.buyTimeArry,function(e,n){return s("span",{key:n,staticClass:"value-time",class:t.bugTimeIndex==n?"click-span":"",on:{click:function(s){return t.bugTime(n,e.campusDuration)}}},[t._v(t._s(e.campusDuration)+"个月")])}),0)]),t._v(" "),s("li",{staticClass:"table-li"},[s("img",{staticClass:"required",attrs:{src:n("2lpC"),alt:""}}),t._v(" "),s("span",{staticClass:"key-content"},[t._v("订单金额(元)")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.money,expression:"money"}],staticClass:"value-content",attrs:{name:"money",id:"money",type:"text",placeholder:"请输入本单订单金额"},domProps:{value:t.money},on:{focus:function(e){return t.focusMoney(0)},blur:function(e){return t.blurMoney(0)},input:function(e){e.target.composing||(t.money=e.target.value)}}})]),t._v(" "),s("li",{staticClass:"table-li"},[s("img",{staticClass:"required",attrs:{src:n("2lpC"),alt:""}}),t._v(" "),s("span",{staticClass:"key-content"},[t._v("收益池收入(元)")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.paymoney,expression:"paymoney"}],staticClass:"value-content",attrs:{name:"paymoney",id:"paymoney",type:"text",placeholder:"请输入本单代理商的收益金额"},domProps:{value:t.paymoney},on:{focus:function(e){return t.focusMoney(1)},blur:function(e){return t.blurMoney(1)},input:function(e){e.target.composing||(t.paymoney=e.target.value)}}})]),t._v(" "),s("li",{staticClass:"table-li table-textarea"},[t._m(0),t._v(" "),s("div",{staticClass:"value-textarea"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.summary,expression:"summary"}],staticStyle:{"margin-left":"-6px"},attrs:{maxlength:"200"},domProps:{value:t.summary},on:{input:function(e){e.target.composing||(t.summary=e.target.value)}}}),t._v(" "),s("span",{staticClass:"count"},[t._v(t._s(t.summaryLength)+"/200字")])])])])]),t._v(" "),s("footer",[s("ul",{staticClass:"table-button"},[s("li",{on:{click:t.cancelFrom}},[t._v("取消")]),t._v(" "),s("li",{staticClass:"from",on:{click:t.submitFrom}},[t._v("提交订单")])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"key-top"},[e("span",{staticClass:"key-content key-span"},[this._v("备注")])])}]},c=n("VU/8")(r,u,!1,null,null,null);e.default=c.exports}});